2022-09-16 19:15:15.871999: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-09-16 19:15:25.887971: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer.so.7'; dlerror: libnvinfer.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /soft/libraries/cudnn/cudnn-11.2-v8.1.0.77/lib64:/soft/libraries/mpi/openmpi/4.1.1/lib:/soft/compilers/gcc/12.1.0/x86_64-suse-linux/lib64:/soft/compilers/cuda/cuda-11.6.2/lib64
2022-09-16 19:15:25.888044: W tensorflow/compiler/xla/stream_executor/platform/default/dso_loader.cc:64] Could not load dynamic library 'libnvinfer_plugin.so.7'; dlerror: libnvinfer_plugin.so.7: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /soft/libraries/cudnn/cudnn-11.2-v8.1.0.77/lib64:/soft/libraries/mpi/openmpi/4.1.1/lib:/soft/compilers/gcc/12.1.0/x86_64-suse-linux/lib64:/soft/compilers/cuda/cuda-11.6.2/lib64
2022-09-16 19:15:25.888051: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:38] TF-TRT Warning: Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
2022-09-16 19:15:37.509375: I tensorflow/compiler/xla/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-09-16 19:15:37.546133: I tensorflow/compiler/xla/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-09-16 19:15:37.548138: I tensorflow/compiler/xla/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-09-16 19:15:37.550440: I tensorflow/core/platform/cpu_feature_guard.cc:193] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2022-09-16 19:15:37.550794: I tensorflow/compiler/xla/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-09-16 19:15:37.552733: I tensorflow/compiler/xla/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-09-16 19:15:37.554654: I tensorflow/compiler/xla/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-09-16 19:15:38.089867: I tensorflow/compiler/xla/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-09-16 19:15:38.091787: I tensorflow/compiler/xla/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-09-16 19:15:38.093460: I tensorflow/compiler/xla/stream_executor/cuda/cuda_gpu_executor.cc:981] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2022-09-16 19:15:38.095129: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1616] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 38220 MB memory:  -> device: 0, name: NVIDIA A100-PCIE-40GB, pci bus id: 0000:43:00.0, compute capability: 8.0
NTHMC 2022-09-16 19:15:37.355115
Python 3.10.6 (main, Sep  1 2022, 19:58:04) [GCC 12.2.0]
TensorFlow 2.11.0-dev20220912 v1.12.1-81213-g53844b49ea4 9.3.1 20200408
Device PhysicalDevice(name='/physical_device:CPU:0', device_type='CPU') PhysicalDevice(name='/physical_device:GPU:0', device_type='GPU')
RandomSeed 9876543211
SU3d4 init with beta 0.7796 coeff (9.56600384, -1.09830048)
2022-09-16 19:15:39.052078: I tensorflow/core/util/cuda_solvers.cc:179] Creating GpuSolver handles for stream 0x21908ce0
### lat [8, 8, 8, 16] nbatch 64
1. Mat Mom
Omelyan2MN init with dt 0.05 step/traj 4
H0 [-413.9096155544795 25.36657630298933 524.44534152537722 ... 219.0199723796708 -287.64524535839666 1298.922507392298] [297.105088821016 -135.57167974707295 1026.137682818578 ... 34.895530282489808 78.5501143969245 450.11527145833168] [-711.01470437549551 160.93825605006228 -501.6923412932008 ... 184.124442097181 -366.19535975532114 848.80723593396635]
tf.function: Time 0.00018310546875 sec
tf.func:jit: Time 0.00010895729064941406 sec
fun concrete: Time 15.006261110305786 sec
jit concrete: Time 9.982533931732178 sec
egr run 0: Time 9.06616497039795 sec
egr run 1: Time 8.934982776641846 sec
egr run 2: Time 8.919105052947998 sec
egr run 0: Time 8.927887916564941 sec
egr run 1: Time 8.931652069091797 sec
egr run 2: Time 8.929795980453491 sec
H1 [-436.93270255004609 2.1754300417305785 501.39513894364791 ... 196.00771446303406 -310.6489917969011 1275.1712829397875] [-49636.229725138808 -50249.612520994691 -49068.901254305674 ... -49739.116394695404 -50033.064818268438 -50434.856066813474] [49199.297022588762 50251.787951036422 49570.296393249322 ... 49935.124109158438 49722.415826471537 51710.027349753262]
dH [-23.023086995566587 -23.191146261258751 -23.050202581729309 ... -23.012257916636742 -23.003746438504493 -23.751224452510542]
fun run 0: Time 125.18310785293579 sec
fun run 1: Time 7.516244173049927 sec
fun run 2: Time 7.5114710330963135 sec
fun run 0: Time 7.51606297492981 sec
fun run 1: Time 7.510008811950684 sec
fun run 2: Time 7.510925054550171 sec
H1 [-436.93270255004609 2.1754300417305785 501.39513894364791 ... 196.00771446303406 -310.6489917969011 1275.1712829397875] [-49636.229725138808 -50249.612520994691 -49068.901254305674 ... -49739.116394695404 -50033.064818268438 -50434.856066813474] [49199.297022588762 50251.787951036422 49570.296393249322 ... 49935.124109158438 49722.415826471537 51710.027349753262]
dH [-23.023086995566587 -23.191146261258751 -23.050202581729309 ... -23.012257916636742 -23.003746438504493 -23.751224452510542]
2022-09-16 19:19:43.000694: I tensorflow/compiler/xla/service/service.cc:173] XLA service 0x6d480220 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
2022-09-16 19:19:43.000732: I tensorflow/compiler/xla/service/service.cc:181]   StreamExecutor device (0): NVIDIA A100-PCIE-40GB, Compute Capability 8.0
2022-09-16 19:19:43.465465: I tensorflow/compiler/mlir/tensorflow/utils/dump_mlir_util.cc:268] disabling MLIR crash reproducer, set env var `MLIR_CRASH_REPRODUCER_DIRECTORY` to enable.
2022-09-16 19:19:55.305379: I tensorflow/compiler/jit/xla_compilation_cache.cc:476] Compiled cluster using XLA!  This line is logged at most once for the lifetime of the process.
jit run 0: Time 22.00645112991333 sec
jit run 1: Time 9.498199939727783 sec
jit run 2: Time 9.497511863708496 sec
jit run 0: Time 9.497261047363281 sec
jit run 1: Time 9.497128009796143 sec
jit run 2: Time 9.49756407737732 sec
H1 [-436.93270255003154 2.1754300417305785 501.39513894364791 ... 196.00771446303406 -310.6489917969011 1275.1712829397875] [-49636.229725138794 -50249.612520994691 -49068.901254305674 ... -49739.116394695404 -50033.064818268438 -50434.856066813474] [49199.297022588762 50251.787951036422 49570.296393249322 ... 49935.124109158438 49722.415826471537 51710.027349753262]
dH [-23.023086995552035 -23.191146261258751 -23.050202581729309 ... -23.012257916636742 -23.003746438504493 -23.751224452510542]
2. Vec Mom
Omelyan2MN init with dt 0.05 step/traj 4
H0 [45.938581457459264 91.6334104153267 838.6732220877027 ... 222.65225344605989 411.39713099226992 124.01495608083439] [297.105088821016 -135.57167974707295 1026.137682818578 ... 34.895530282489808 78.5501143969245 450.11527145833168] [-251.16650736355675 227.20509016239964 -187.46446073087535 ... 187.75672316357009 332.84701659534539 -326.10031537749728]
tf.function: Time 0.0001499652862548828 sec
tf.func:jit: Time 0.00010609626770019531 sec
fun concrete: Time 13.36782193183899 sec
jit concrete: Time 12.071222066879272 sec
egr run 0: Time 15.013831853866577 sec
egr run 1: Time 14.899109125137329 sec
egr run 2: Time 14.905174016952515 sec
egr run 0: Time 14.899708032608032 sec
egr run 1: Time 14.852313995361328 sec
egr run 2: Time 14.826112985610962 sec
H1 [40.004473128748941 85.841778744084877 832.90549488112083 ... 216.74396255873944 405.60869357230331 118.11554181016254] [-26583.190631103651 -26483.23225252028 -25384.667424578824 ... -26803.110201407464 -26084.2827627242 -26362.024786999173] [26623.1951042324 26569.074031264365 26217.572919459944 ... 27019.854163966203 26489.891456296504 26480.140328809335]
dH [-5.9341083287103231 -5.7916316712418165 -5.7677272065818386 ... -5.9082908873204474 -5.7884374199666127 -5.8994142706718549]
fun run 0: Time 159.83951902389526 sec
fun run 1: Time 12.676793098449707 sec
fun run 2: Time 12.685793161392212 sec
fun run 0: Time 12.684843063354492 sec
fun run 1: Time 12.689556121826172 sec
fun run 2: Time 12.682888984680176 sec
H1 [40.004473128748941 85.841778744084877 832.90549488111719 ... 216.74396255873944 405.60869357230331 118.11554181016254] [-26583.190631103651 -26483.23225252028 -25384.667424578824 ... -26803.110201407464 -26084.2827627242 -26362.024786999173] [26623.1951042324 26569.074031264365 26217.572919459941 ... 27019.854163966203 26489.891456296504 26480.140328809335]
dH [-5.9341083287103231 -5.7916316712418165 -5.7677272065854766 ... -5.9082908873204474 -5.7884374199666127 -5.8994142706718549]
jit run 0: Time 38.32369089126587 sec
jit run 1: Time 14.214134931564331 sec
jit run 2: Time 14.21324110031128 sec
jit run 0: Time 14.217855215072632 sec
jit run 1: Time 14.21560287475586 sec
jit run 2: Time 14.219090938568115 sec
H1 [40.004473128748941 85.841778744088515 832.90549488111719 ... 216.74396255873944 405.60869357230331 118.11554181016254] [-26583.190631103651 -26483.23225252028 -25384.667424578824 ... -26803.110201407464 -26084.2827627242 -26362.024786999173] [26623.1951042324 26569.074031264368 26217.572919459941 ... 27019.854163966203 26489.891456296504 26480.140328809335]
dH [-5.9341083287103231 -5.7916316712381786 -5.7677272065854766 ... -5.9082908873204474 -5.7884374199666127 -5.8994142706718549]
3. Vec Mom from Mat
Omelyan2MN init with dt 0.05 step/traj 4
H0 [134.83719432124795 220.50542429363441 1574.2730227704703 ... -215.72356638423915 173.02977911544045 237.19075635967465] [297.105088821016 -135.57167974707295 1026.137682818578 ... 34.895530282489808 78.5501143969245 450.11527145833168] [-162.26789449976806 356.07710404070735 548.13533995189232 ... -250.61909666672895 94.479664718515949 -212.92451509865703]
tf.function: Time 0.0001480579376220703 sec
tf.func:jit: Time 0.00011515617370605469 sec
fun concrete: Time 11.716838836669922 sec
jit concrete: Time 10.872497797012329 sec
egr run 0: Time 9.44577693939209 sec
egr run 1: Time 9.354284048080444 sec
egr run 2: Time 9.357646942138672 sec
egr run 0: Time 9.345453977584839 sec
egr run 1: Time 9.35654878616333 sec
egr run 2: Time 9.368365049362183 sec
H1 [129.02939962118398 214.67223122273208 1568.279698991737 ... -221.55161566424431 167.22284779704569 231.26798334113846] [-26166.104420017778 -26648.711779427154 -25731.474562819036 ... -26693.154632467282 -26563.124967715212 -26548.28469109557] [26295.133819638962 26863.384010649886 27299.754261810773 ... 26471.603016803037 26730.347815512258 26779.552674436709]
dH [-5.8077947000639654 -5.8331930709023254 -5.9933237787333837 ... -5.82804928000516 -5.80693131839476 -5.9227730185361906]
fun run 0: Time 133.5438051223755 sec
fun run 1: Time 7.583822965621948 sec
fun run 2: Time 7.586591005325317 sec
fun run 0: Time 7.590614080429077 sec
fun run 1: Time 7.589227914810181 sec
fun run 2: Time 7.58516788482666 sec
H1 [129.02939962118035 214.67223122273208 1568.279698991737 ... -221.55161566424431 167.22284779703841 231.26798334113846] [-26166.104420017786 -26648.711779427154 -25731.474562819036 ... -26693.154632467282 -26563.124967715212 -26548.28469109557] [26295.133819638966 26863.384010649886 27299.754261810773 ... 26471.603016803037 26730.34781551225 26779.552674436709]
dH [-5.8077947000676033 -5.8331930709023254 -5.9933237787333837 ... -5.82804928000516 -5.8069313184020359 -5.9227730185361906]
2022-09-16 19:33:22.482173: I tensorflow/compiler/xla/stream_executor/gpu/asm_compiler.cc:327] ptxas warning : Registers are spilled to local memory in function 'fusion_202', 8 bytes spill stores, 8 bytes spill loads
ptxas warning : Registers are spilled to local memory in function 'fusion_344', 16 bytes spill stores, 16 bytes spill loads

jit run 0: Time 57.30441498756409 sec
jit run 1: Time 9.540846109390259 sec
jit run 2: Time 9.535562992095947 sec
jit run 0: Time 9.53386902809143 sec
jit run 1: Time 9.535031080245972 sec
jit run 2: Time 9.53429102897644 sec
H1 [129.02939962118762 214.67223122273208 1568.279698991737 ... -221.55161566424431 167.22284779704569 231.26798334114574] [-26166.104420017778 -26648.711779427154 -25731.474562819036 ... -26693.154632467282 -26563.124967715212 -26548.284691095563] [26295.133819638966 26863.384010649886 27299.754261810773 ... 26471.603016803037 26730.347815512258 26779.552674436709]
dH [-5.8077947000603274 -5.8331930709023254 -5.9933237787333837 ... -5.82804928000516 -5.80693131839476 -5.9227730185289147]
4. Part Mat Mom
Omelyan2MN init with dt 0.05 step/traj 4
H0 [121.20144498893245 103.71934235352134 582.02434244350957 ... 150.59679266409603 36.937661457673833 74.989288134029607] [297.1050888210163 -135.57167974707312 1026.137682818578 ... 34.895530282489752 78.550114396924371 450.11527145833179] [-175.90364383208384 239.29102210059446 -444.11334037506845 ... 115.70126238160627 -41.612452939250538 -375.12598332430218]
tf.function: Time 0.0001900196075439453 sec
tf.func:jit: Time 0.000102996826171875 sec
fun concrete: Time 107.73950791358948 sec
jit concrete: Time 109.71770715713501 sec
egr run 0: Time 15.930426836013794 sec
egr run 1: Time 15.76294493675232 sec
egr run 2: Time 15.681206941604614 sec
egr run 0: Time 15.679971933364868 sec
egr run 1: Time 17.01453995704651 sec
egr run 2: Time 15.52360200881958 sec
H1 [98.445821655703185 80.210519649554044 558.7540021697132 ... 127.44047162458446 13.619668900748366 51.715911370862159] [-49474.443263508932 -50723.377613481083 -49253.431919935349 ... -49993.905668306266 -50615.393307328864 -49946.6077171388] [49572.889085164636 50803.588133130637 49812.185922105062 ... 50121.346139930851 50629.012976229613 49998.323628509665]
dH [-22.755623333229266 -23.508822703967297 -23.270340273796364 ... -23.156321039511553 -23.317992556925468 -23.273376763167448]
fun run 0: Time 152.89773392677307 sec
fun run 1: Time 8.450016021728516 sec
fun run 2: Time 8.47326111793518 sec
fun run 0: Time 8.644958019256592 sec
fun run 1: Time 8.514254093170166 sec
fun run 2: Time 8.644402027130127 sec
H1 [98.445821655703185 80.210519649554044 558.7540021697132 ... 127.44047162459174 13.619668900762917 51.715911370862159] [-49474.443263508932 -50723.377613481083 -49253.431919935349 ... -49993.905668306266 -50615.393307328864 -49946.6077171388] [49572.889085164636 50803.588133130637 49812.185922105062 ... 50121.346139930858 50629.012976229627 49998.323628509665]
dH [-22.755623333229266 -23.508822703967297 -23.270340273796364 ... -23.156321039504277 -23.317992556910916 -23.273376763167448]
2022-09-16 19:49:35.485165: E tensorflow/compiler/xla/service/slow_operation_alarm.cc:65] 
********************************
[Compiling module a_inference_mdfun__554837__XlaMustCompile_true_config_proto_9055505835036088825_executor_type_11160318154034397263_.199682] Very slow compile?  If you want to file a bug, run with envvar XLA_FLAGS=--xla_dump_to=/tmp/foo and attach the results.
********************************
2022-09-16 19:53:58.790988: I tensorflow/compiler/xla/stream_executor/gpu/asm_compiler.cc:327] ptxas warning : Registers are spilled to local memory in function 'fusion_1498', 8 bytes spill stores, 8 bytes spill loads
ptxas warning : Registers are spilled to local memory in function 'fusion_1745', 28 bytes spill stores, 36 bytes spill loads
ptxas warning : Registers are spilled to local memory in function 'fusion_1778', 11088 bytes spill stores, 12028 bytes spill loads
ptxas warning : Registers are spilled to local memory in function 'fusion_1951', 8 bytes spill stores, 8 bytes spill loads
ptxas warning : Registers are spilled to local memory in function 'fusion_2904', 8 bytes spill stores, 8 bytes spill loads
ptxas warning : Registers are spilled to local memory in function 'fusion_3132', 64 bytes spill stores, 64 bytes spill loads
ptxas warning : Registers are spilled to local memory in function 'fusion_4217', 8 bytes spill stores, 8 bytes spill loads
ptxas warning : Registers are spilled to local memory in function 'fusion_4407', 24 bytes spill stores, 72 bytes spill loads
ptxas warning : Registers are spilled to local memory in function 'fusion_4717', 72 bytes spill stores, 152 bytes spill loads
ptxas warning : Registers are spilled to local memory in function 'fusion_4570', 56 bytes spill stores, 120 bytes spill loads
ptxas warning : Registers are spilled to local memory in function 'fusion_6140', 72 bytes spill stores, 184 bytes spill loads
ptxas warning : Registers are spilled to local memory in function 'fusion_7420', 136 bytes spill stores, 200 bytes spill loads

2022-09-16 19:53:59.311776: E tensorflow/compiler/xla/service/slow_operation_alarm.cc:133] The operation took 6m23.826705952s

********************************
[Compiling module a_inference_mdfun__554837__XlaMustCompile_true_config_proto_9055505835036088825_executor_type_11160318154034397263_.199682] Very slow compile?  If you want to file a bug, run with envvar XLA_FLAGS=--xla_dump_to=/tmp/foo and attach the results.
********************************
Traceback (most recent call last):
  File "/gpfs/jlse-fs0/users/xjin/W/nthmc/bench/omelyan.py", line 82, in <module>
    run(gconfP, TransformedActionMatrixBase(transform=Ident(), action=act))
  File "/gpfs/jlse-fs0/users/xjin/W/nthmc/bench/omelyan.py", line 69, in run
    (x,p),_ = bench('jit',lambda:mdfun(fjit,x,p))
  File "/gpfs/jlse-fs0/users/xjin/W/nthmc/bench/benchutil.py", line 25, in bench
    r,t = time(s,f,n=3)
  File "/gpfs/jlse-fs0/users/xjin/W/nthmc/bench/benchutil.py", line 8, in time
    ret = f()
  File "/gpfs/jlse-fs0/users/xjin/W/nthmc/bench/omelyan.py", line 69, in <lambda>
    (x,p),_ = bench('jit',lambda:mdfun(fjit,x,p))
  File "/gpfs/jlse-fs0/users/xjin/W/nthmc/bench/omelyan.py", line 47, in mdfun
    x_,p_ = f(x.to_tensors(),p.to_tensors())
  File "/gpfs/jlse-fs0/users/xjin/gpu/pyvenv_nightly/lib/python3.10/site-packages/tensorflow/python/eager/polymorphic_function/monomorphic_function.py", line 1473, in __call__
    return self._call_impl(args, kwargs)
  File "/gpfs/jlse-fs0/users/xjin/gpu/pyvenv_nightly/lib/python3.10/site-packages/tensorflow/python/eager/polymorphic_function/monomorphic_function.py", line 1482, in _call_impl
    return self._call_with_structured_signature(args, kwargs,
  File "/gpfs/jlse-fs0/users/xjin/gpu/pyvenv_nightly/lib/python3.10/site-packages/tensorflow/python/eager/polymorphic_function/monomorphic_function.py", line 1563, in _call_with_structured_signature
    return self._call_flat(
  File "/gpfs/jlse-fs0/users/xjin/gpu/pyvenv_nightly/lib/python3.10/site-packages/tensorflow/python/eager/polymorphic_function/monomorphic_function.py", line 1744, in _call_flat
    return self._build_call_outputs(self._inference_function.call(
  File "/gpfs/jlse-fs0/users/xjin/gpu/pyvenv_nightly/lib/python3.10/site-packages/tensorflow/python/eager/polymorphic_function/monomorphic_function.py", line 377, in call
    outputs = execute.execute(
  File "/gpfs/jlse-fs0/users/xjin/gpu/pyvenv_nightly/lib/python3.10/site-packages/tensorflow/python/eager/execute.py", line 52, in quick_execute
    tensors = pywrap_tfe.TFE_Py_Execute(ctx._handle, device_name, op_name,
tensorflow.python.framework.errors_impl.InternalError: Failed to launch CUDA kernel: fusion_1778 with block dimensions: 256x1x1 and grid dimensions: 288x1x1: CUDA_ERROR_OUT_OF_MEMORY: out of memory [Op:__inference_mdfun__554837]
