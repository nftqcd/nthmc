import tensorflow as tf
import tensorflow.keras as tk
import nthmc, ftr, hmctrain
import sys
sys.path.append('../lib')
import field

conf = nthmc.Conf(nbatch=64, nepoch=2, nstepEpoch=128, nstepMixing=64, nstepPostTrain=1024, initDt=0.1, stepPerTraj=20)
nthmc.setup(conf)

# using the exact model from t_force_b25_0.py, except for trainable=False in TransformChain

op0 = (((1,2,-1,-2), (1,-2,-1,2)),
       ((1,1,2,-1,-1,-2), (1,1,-2,-1,-1,2), (1,2,-1,-1,-2,1), (1,-2,-1,-1,2,1)))
# requires different coefficient bounds:
# (1,2,-1,-2,1,-2,-1,2)
# (1,2,-1,-2,1,2,-1,-2)
# (1,-2,-1,2,1,-2,-1,2)
op1 = (((2,-1,-2,1), (2,1,-2,-1)),
       ((2,2,-1,-2,-2,1), (2,2,1,-2,-2,-1), (2,-1,-2,-2,1,2), (2,1,-2,-2,-1,2)))
fixedP = (1,2,-1,-2)
fixedR0 = (2,2,1,-2,-2,-1)
fixedR1 = (1,1,2,-1,-1,-2)
convP0 = lambda: ftr.PeriodicConv((
    tk.layers.Conv2D(2, (3,2), activation='gelu', kernel_initializer=tk.initializers.RandomNormal(), bias_initializer=tk.initializers.RandomNormal()),
))
convP1 = lambda: ftr.PeriodicConv((
    tk.layers.Conv2D(2, (2,3), activation='gelu', kernel_initializer=tk.initializers.RandomNormal(), bias_initializer=tk.initializers.RandomNormal()),
))
convR = lambda pad: ftr.PeriodicConv((
    tk.layers.Conv2D(2, (3,3), activation='gelu', kernel_initializer=tk.initializers.RandomNormal(), bias_initializer=tk.initializers.RandomNormal()),
), pad)
conv = lambda: ftr.PeriodicConv((
    tk.layers.Conv2D(2, (3,3), activation='gelu', kernel_initializer=tk.initializers.RandomNormal(), bias_initializer=tk.initializers.RandomNormal()),
    tk.layers.Conv2D(2, (3,3), activation=None, kernel_initializer=tk.initializers.RandomNormal(), bias_initializer=tk.initializers.RandomNormal()),
))
transform = lambda: ftr.TransformChain([
    ftr.GenericStoutSmear(((0,0),(2,2)), op0, [(fixedP, convP0()), (fixedR0, convR((1,2)))], conv()),
    ftr.GenericStoutSmear(((0,1),(2,2)), op0, [(fixedP, convP0()), (fixedR0, convR((1,2)))], conv()),
    ftr.GenericStoutSmear(((1,0),(2,2)), op0, [(fixedP, convP0()), (fixedR0, convR((1,2)))], conv()),
    ftr.GenericStoutSmear(((1,1),(2,2)), op0, [(fixedP, convP0()), (fixedR0, convR((1,2)))], conv()),
    ftr.GenericStoutSmear(((0,0),(2,2)), op1, [(fixedP, convP1()), (fixedR1, convR((2,1)))], conv()),
    ftr.GenericStoutSmear(((1,0),(2,2)), op1, [(fixedP, convP1()), (fixedR1, convR((2,1)))], conv()),
    ftr.GenericStoutSmear(((0,1),(2,2)), op1, [(fixedP, convP1()), (fixedR1, convR((2,1)))], conv()),
    ftr.GenericStoutSmear(((1,1),(2,2)), op1, [(fixedP, convP1()), (fixedR1, convR((2,1)))], conv()),
], trainable=False)
ftr.checkDep(transform())
rng = tf.random.Generator.from_seed(conf.seed)
loss = lambda action: nthmc.LossFun(action, cCosDiff=0.0, cTopoDiff=1.0, cForce2=0.0, dHmin=0.0, topoFourierN=1)
opt = tk.optimizers.Adam(learning_rate=0.001)
beta = 6.0
mcmc = lambda: nthmc.Metropolis(conf, nthmc.LeapFrog(conf, nthmc.U1d2(beta=beta, beta0=4.0, size=(16,16), transform=transform(), nbatch=conf.nbatch, rng=rng.split()[0])))

# Get the weights from the end of the epoch with beta=5
# <ssam -n '/^beta: 5$//done training epoch/?^weights?;/^[^ ]/-' t_force_b25_0.log|grep -v '^$'
# Edit x/ +[0-9\-]/s/ /, /
# Edit x/[^,]$/a/,/
weights=list(map(lambda x:tf.constant(x,dtype=tf.float64),
 [[[[[0.38340238697446233, -0.070777590634820656]],
  [[0.094587661058106842, 0.015118022245258805]]],
 [[[0.26056095704544235, -0.97780160719767018]],
  [[0.16870267553301135, -0.41774831042698579]]],
 [[[0.28195613699308392, -0.061598450776203212]],
  [[0.03454012901889205, -0.12773521731538395]]]],
 [0.040594043271197977, 0.35333232040068596],
 [[[[-0.21158801169991798, 0.13983496611950691]],
  [[0.13471904575282762, -0.18703000168270173]],
  [[-0.26784901529967053, 0.023066026553038542]]],
 [[[-0.032047838403048069, 0.47715997658893861]],
  [[0.49486651865829123, 0.22506372116494716]],
  [[0.11702185446530464, 0.51245936379809665]]],
 [[[0.13456670679377233, 0.03750005412129935]],
  [[0.00892004079463671, 0.10791321151165244]],
  [[0.1692481235619975, 0.21391000077017441]]]],
 [0.50943988781544292, 0.18722319884226132],
 [[[[-0.19321544592995807, -0.12809329158919988],
   [0.76635035659248429, 0.57788256755335754],
   [-0.23876221259036978, -0.037805043496152359],
   [-0.42453758584847795, -0.12189813124398073]],
  [[-0.38582274571089192, -0.11800167350811232],
   [0.46786771225654489, 0.528209072070044],
   [-0.32876393461869124, -0.15866518820186731],
   [-0.20015425330575817, -0.13827422612743234]],
  [[0.1823824070547061, -0.13710401860949445],
   [-0.21617718917899473, 0.543493399175576],
   [0.13473825187849278, 0.017964398044877768],
   [-0.20035624922410941, -0.10258122468436577]]],
 [[[-0.1259193200951787, -0.16206543272458565],
   [0.18368851292821578, 0.28544563785435251],
   [0.40781058033696932, -0.062192103137413676],
   [0.21966082083438632, -0.043054022533554011]],
  [[-0.064848102045050732, -0.37183311006373521],
   [0.43525724048093017, 0.75977893262627316],
   [-0.046461627118103449, -0.092422735809349746],
   [0.21866740073008067, -0.1396499947714972]],
  [[0.11167344618658628, -0.19363561669277418],
   [-0.35350892375606546, 0.55447363401041783],
   [0.23802136356816683, -0.1152925219106503],
   [-0.0843271632523507, 0.051524588483269712]]],
 [[[-0.0934450598839688, -0.034938972467311362],
   [0.08288460517819754, -0.023201816893024668],
   [-0.040421105411121629, 0.0073493583016151177],
   [0.025697761119593262, -0.0032067684075763533]],
  [[-0.094691131326272271, -0.11219097584438156],
   [0.17240988820399769, 0.23884865749243739],
   [0.14790040683729816, 0.076280472412866535],
   [-0.047496964809464033, -0.087889202935784685]],
  [[0.081363602752514544, -0.07358311884480008],
   [0.24590576400121736, 0.17538652695334939],
   [0.014987805859931688, -0.0063735468458123263],
   [-0.028877554132183694, 0.0036142296772476018]]]],
 [0.17212752204138723, -0.010186787298600815],
 [[[[-0.12853396381561921, 0.071430989842607054],
   [-0.59785250724720984, -0.077372793499760562]],
  [[-0.27500285242469397, 0.029892962269338647],
   [-0.56334844740341949, 0.12798717216225153]],
  [[0.0021119713289399536, 0.15064953780052828],
   [-0.72939859245694616, -0.051918946558034876]]],
 [[[-0.25734623660060341, -0.016443377935743381],
   [-0.6658926768722, -0.091664126914773686]],
  [[0.061791439668371653, -0.015752333794881886],
   [-0.73809049916155411, -0.0889014510754899]],
  [[0.066371726432952624, 0.10038846215711736],
   [-0.587288498500944, -0.1249145345798255]]],
 [[[-0.23583456529408875, -0.10560226501143193],
   [-0.64285132210770224, -0.21488512503947951]],
  [[1.1104558458858633, 0.29918103201107182],
   [-0.62970627324385409, 0.08540501778443578]],
  [[0.7881869545877952, 0.34192822399817552],
   [-0.7288847165946557, -0.11716486579752856]]]],
 [0.41065493531332803, 0.0589309203805388],
 [[[[0.036613053828112911, 0.20058061751495054]],
  [[-0.24496943415311168, 0.16397496815416146]]],
 [[[0.027390178114571707, 0.15341148250373451]],
  [[-0.00887213796302564, 0.037078067845294285]]],
 [[[0.17918870267310227, 0.29990582560793028]],
  [[-0.13917493939357067, -0.017897603320928039]]]],
 [0.23347373750096598, 0.24941974086039387],
 [[[[-0.47627931867286216, -0.045142687207281325]],
  [[-0.96931030354507219, 0.015227745679815758]],
  [[-0.11188176667553412, -0.081122997540210809]]],
 [[[-0.069762396456936687, 0.014699629342232939]],
  [[-0.087542518987270959, -0.15359348283942989]],
  [[0.089634864005390863, -0.0671145412808599]]],
 [[[-0.18374108149120305, -0.11639956117683564]],
  [[-0.052055863940690339, -0.523979648420398]],
  [[-0.0097977222969878718, -1.2268723557682928]]]],
 [0.43668506234128279, 0.260465561442593],
 [[[[0.023341672932212929, 0.088354138618822381],
   [0.19471212018416892, 0.093659976667276448],
   [0.0076331146459709311, -0.072363123247644337],
   [-0.0054750859392462235, 0.43834665564611042]],
  [[0.078223850008006079, 0.19050545095485386],
   [0.10761729777460442, 0.14412795476281026],
   [-0.01056457667838635, -0.16752398342682454],
   [0.071304298875754346, 0.78182686372960519]],
  [[-0.2863446831552206, 0.16056261249766671],
   [-0.047680872488348076, 0.10858639207143714],
   [-0.069393411702422317, -0.10655652495923451],
   [0.045647273066758365, 0.12569637852191159]]],
 [[[-0.11360159714827614, 0.098069773949085046],
   [0.4656437263516176, 0.036081860143073255],
   [0.23243382932865156, 0.0213469408307285],
   [0.58825415645919588, -0.083770435032550966]],
  [[0.50275670011813556, 0.4011109659521348],
   [0.27154389224293873, 0.004561639851280842],
   [0.1593408206103421, 0.10708768791344832],
   [0.47364362297741636, 0.2033317922514031]],
  [[0.11499078523572949, -0.075912174207194774],
   [-0.076085931144485378, -0.011827066822952273],
   [0.3732385110175318, 0.39909771659156235],
   [0.14978489209842807, 0.14538338440153639]]],
 [[[0.077691411261649662, 0.0826185535488756],
   [0.38751484971208555, 0.11061594377831664],
   [-0.055232448636925148, -0.25705745068664354],
   [-0.13849629949179326, -0.22758481764981617]],
  [[0.2476508597885142, 0.0944808265034339],
   [0.21533305327438357, 0.16643635775946647],
   [-0.051584321722884484, 0.34230916240690729],
   [0.096385772552886856, -0.18848194694020384]],
  [[-0.264885661546742, 0.20365342127940975],
   [-0.15877447013930837, 0.083351235475644256],
   [-0.19809020700547084, 0.85665082463371844],
   [0.00076416237576950848, -0.24044928167394072]]]],
 [0.03104246857453298, 0.19407769769307173],
 [[[[0.10435570212389901, 0.057322941383456831],
   [0.23680519499294039, -0.048578273595073]],
  [[0.44672045986196596, 0.17089904985246934],
   [0.11981064071718957, -0.040977308827868264]],
  [[0.12840242526940496, -0.26066846729860976],
   [-0.026591994201670795, 0.059003770541094125]]],
 [[[-0.14348545496049059, 0.022763584875693639],
   [0.9736794277168298, 0.17202209673957486]],
  [[-0.14250487237371709, -0.14338812079370927],
   [0.90680279177394008, 0.14599817443447788]],
  [[-0.37445014687146805, -0.29734430620705876],
   [-0.070483952565213448, -0.0092067678554188914]]],
 [[[0.13857625185494979, 0.00809589249622789],
   [0.23495861139203555, -0.025911968784605232]],
  [[0.1206952028824772, 0.0026053234661631165],
   [0.15946625439700757, 0.012999697336418077]],
  [[0.080003064827908171, -0.031340180125383379],
   [0.066138595522771931, 0.094622061791528864]]]],
 [0.10186077999102623, 0.18289823792716733],
 [[[[0.31175364893520535, 0.1309516749039018]],
  [[0.059685659855267088, 0.1987736600685405]]],
 [[[-0.00071018490336281542, 0.22171694622570659]],
  [[0.32371823859028787, -0.037283440736869143]]],
 [[[-0.75623138986551641, 0.23338919737066105]],
  [[-1.1904573450670255, 0.19525615208846323]]]],
 [0.013004063728138712, 0.21354452611163163],
 [[[[0.1004119639059291, -0.801384494022011]],
  [[-0.075233454765339922, -0.69722154208085]],
  [[0.085699625169630672, -0.25298603588288632]]],
 [[[-0.94654177673371609, 0.065523592744979181]],
  [[-0.52198092112756511, -0.12963272431021863]],
  [[0.022626970075839355, 0.14276235668194373]]],
 [[[-0.31793330493587085, -0.081583858698873857]],
  [[-0.49976381581591744, 0.01563330048792972]],
  [[-0.077390473738599488, -0.01071531771137654]]]],
 [0.12603583782668751, 0.40083142291779739],
 [[[[-0.67342310336422406, 0.13674771924858875],
   [0.3443662538780824, 0.10835506033995039],
   [-0.02602994258083512, 0.10581776256801337],
   [0.013556452619936611, 0.21161726437168904]],
  [[-0.45760991907024917, -0.060412792600413906],
   [0.19564027905402098, 0.0032801989174151107],
   [-0.038423193818555669, 0.092446862861878976],
   [-0.0737209854900151, 0.23751218936028115]],
  [[0.535298840715999, -0.021995451982045309],
   [-0.047186502339279117, 0.0063269813033622535],
   [0.22864825177155126, 0.046212895708714147],
   [0.093923100761722667, 0.23211035863189666]]],
 [[[0.1008118906815819, 0.37859601400774],
   [0.15395609064677904, -0.0026825446279697793],
   [-0.13468910274130733, 0.041302981669708506],
   [-0.11371830386418455, 0.018329022436751982]],
  [[-0.16110824418499359, 0.26643890797412],
   [0.10283891231477921, 0.1659701145757248],
   [0.15842531251954411, 0.28247074526652988],
   [0.20401200193242414, -0.092172476910711593]],
  [[-0.38355134590609563, 0.2990596736263616],
   [0.00603816255738367, -0.12262779561853161],
   [0.59329955097421883, -0.08615370194785664],
   [0.28783649640067033, -0.014535901398653406]]],
 [[[-0.51418040365813278, 0.51895434176255839],
   [0.40880003802160347, 0.0048760647503508434],
   [-0.11969320333957459, 0.28685426617458876],
   [0.28541783751646893, 0.27333239834948508]],
  [[-0.45233528602754525, 0.55498430579321545],
   [0.1759733115862066, 0.024689969084819824],
   [-0.095254224527152834, 0.14245511487933],
   [0.69033034878132493, -0.052833036445180753]],
  [[0.34740135055112953, 0.73574414486922979],
   [-0.092633621465457061, -0.010582062253249072],
   [0.10322913758268237, 0.28599389945607284],
   [0.83217518492265585, -0.26490663270281467]]]],
 [0.18883718133453029, -0.081822324333126348],
 [[[[0.0767992386006361, 0.14039074824740502],
   [-0.23382909449638128, -0.18020093835787529]],
  [[0.19296083960991869, -0.163069154753003],
   [-0.073972198980511647, -0.052777182942426289]],
  [[-0.069307352890602442, -0.026780219444623714],
   [-0.11170111040897887, -0.34373784516863676]]],
 [[[0.53967497028727729, -0.11498741715005931],
   [-0.19141386377778752, 0.0851596351829826]],
  [[1.1231962758672009, 0.35999623173243683],
   [-0.18462487132581221, -0.11894346558407369]],
  [[0.12238994073888376, 0.018313461197088508],
   [0.0911254489692039, 0.017037896098656739]]],
 [[[0.23894817446472941, 0.096064197330972878],
   [-0.2102534185049216, -0.24233307839900342]],
  [[0.20547681778919918, -0.075432638052909],
   [-0.43725615914390081, -0.21981067978726046]],
  [[-0.047728583590152959, -0.028009292582387397],
   [-0.65713831404447887, -0.18400833169967157]]]],
 [0.14412151599674988, 0.12873964389372916],
 [[[[0.30211202507338597, 0.11718187328821943]],
  [[0.13147207946936235, 0.32847007370548503]]],
 [[[0.12113070720784629, -0.075319167465718775]],
  [[0.052578564274067346, -0.27868483377516307]]],
 [[[0.23698014970737419, 0.11968443914024239]],
  [[0.0951223360665027, 0.33081629172526628]]]],
 [0.23000885827815223, 0.18272462080504634],
 [[[[0.2395192231249004, -0.21967219898426371]],
  [[0.15949029719347566, 0.073405003702313482]],
  [[0.049942456454128495, -0.61306748559632807]]],
 [[[0.2680657597680341, -0.013070441981157945]],
  [[0.39448832947472356, -0.026723637925828655]],
  [[-0.40370170195961785, -0.032550365686778958]]],
 [[[0.2901287822994662, -0.14425740448572896]],
  [[0.16854362809167703, -1.3677523512543635]],
  [[0.028037422629129959, -0.13146884335913808]]]],
 [-0.020081369386573875, 0.0669882528979384],
 [[[[0.12335342977647445, 0.14557984730327925],
   [0.19523539354739625, 0.04861099003561125],
   [0.082288599093547188, 0.09827467664002261],
   [0.2027601927390591, -0.13691364348641558]],
  [[0.19415016142612684, 0.061131651476807713],
   [0.25600421724054878, 0.076318758828382641],
   [-0.056700443587783159, -0.14523793397941734],
   [0.61872664373088659, 0.79595795528706259]],
  [[0.11017959975436227, 0.13154790988747667],
   [-0.11835903827012745, 0.0809470136918844],
   [-0.40643656032775693, -0.16209260214826673],
   [-0.2034975461368615, -0.39188809527733043]]],
 [[[0.2551393422401374, 0.24258519645274271],
   [-0.21621440373182391, 0.11373886373386534],
   [0.43261664029873509, 0.017899447940204045],
   [0.27366755794888, 0.00059299295310618044]],
  [[-0.055333029744305089, 0.066952843407488971],
   [-0.015434836920551049, -0.057921368244009681],
   [-0.45243200752306795, -0.41650923812590585],
   [-0.088162441185320878, 0.33513577366744907]],
  [[0.35405395544438789, 0.1014362005590326],
   [0.376747635164325, 0.3328462025635795],
   [-0.55028847716746043, -0.10206899590817017],
   [0.40153727207902118, -0.1592475234702268]]],
 [[[-0.0014310086679161882, 0.14900965300472807],
   [0.25368353815815986, 0.025411671500020005],
   [-0.080253277666405665, 0.11793480915459535],
   [0.26762368614636489, -0.16642314653577814]],
  [[0.26928584662564259, 0.033267759157348746],
   [0.22554178051527043, 0.11092206900294026],
   [0.077417148229294935, -0.11799263708685458],
   [-0.30995730362265633, -0.18791451941753112]],
  [[0.1509183506502377, 0.064267554824524217],
   [-0.22597454991257268, 0.18489939337588074],
   [-0.38296783317310951, -0.0687854878367402],
   [0.038721693692008861, -0.39034085442664107]]]],
 [0.10599793906083904, 0.14750743404359051],
 [[[[0.28554235392935562, 0.1311510300122273],
   [-0.15159439260623475, 0.016696964176386858]],
  [[0.068842179038426946, -0.22349598775092303],
   [0.19621634363993906, 0.0591949721904214]],
  [[0.16284462453159806, 0.037729906324869708],
   [0.052131502648767182, -0.0086293894700248449]]],
 [[[-0.26608529665300373, -0.31201316187855566],
   [-0.24508252300161507, -0.011303945455692585]],
  [[1.0452785004846521, 0.2293657717584302],
   [0.829956986450387, 0.14164525977521605]],
  [[-0.11632344332595601, 0.12899430015093322],
   [0.018033491143835498, -0.12754018340689643]]],
 [[[0.012578705727717489, -0.0039851086554174436],
   [0.04967771932731474, 0.12052342860100433]],
  [[0.16864080680834961, -0.22360052247027687],
   [0.33153084630057766, 0.015833591404411363]],
  [[-0.019818837453386851, -0.067084997788873071],
   [0.10871406640136108, 0.13995761597129808]]]],
 [0.11566045497065211, 0.2473510395238129],
 [[[[-0.67870069105471464, -0.48746226432348705]],
  [[0.28846525349528612, 0.025337360897117581]],
  [[0.09913509963627197, -0.267322585784987]]],
 [[[-0.74310880928246736, 0.083397942196982239]],
  [[0.30829835699406694, -0.50465105418531431]],
  [[0.068992754024201311, -0.553882543989831]]]],
 [-0.0046604726974055957, -0.094043165148146909],
 [[[[-0.82065595375248257, 0.094476146488003926]],
  [[0.062256278582507131, -1.0759784623073942]],
  [[0.12572413592605905, -0.11609804577659109]]],
 [[[-0.35869710165938246, -0.15727803551628608]],
  [[0.070644985405659722, 0.086709839434100766]],
  [[-0.25273782519015031, -0.10429117461863131]]],
 [[[-0.032024174190254467, 0.085731875141419139]],
  [[0.1501519884199923, -0.049813163167799983]],
  [[0.13856786165180052, 0.090771897503625978]]]],
 [-0.059120976602107765, -0.017895678574555634],
 [[[[0.16148312582603019, -0.74775446646365318],
   [-0.67053450525083169, -0.33563945371998422],
   [-0.2844435831569469, -0.18012975760821837],
   [-0.22244784335234452, -0.10496086815477521]],
  [[-0.26202899019164194, 0.12184623598134234],
   [-0.34586103671731483, -0.31931435919201157],
   [-0.16872071064197824, 0.055160217188157008],
   [0.0458530736647197, -0.36190735580045386]],
  [[0.22699073978468412, -0.51078343779588808],
   [-0.46032093333783169, -0.35981313038114132],
   [-0.1196869353963561, 0.0013346608784861288],
   [0.069116221104342582, -0.31968177264437675]]],
 [[[-0.20952892696346836, 0.20327783093983157],
   [-0.51643770211164408, -0.21552016430898491],
   [-0.36945206079110104, -0.14236013848395213],
   [-0.48515092164865742, -0.4143957603997741]],
  [[0.21341617698420948, -0.31803286024033528],
   [-0.27334690393115457, -0.087527271595937928],
   [-0.54099965023848118, 0.045375120862385536],
   [-0.7252993973304559, 0.31357491539904492]],
  [[0.0068437706562650058, 0.52181170771313279],
   [-0.24585464591610331, -0.36310493697670371],
   [-0.74736670491109314, 0.18991750953631126],
   [0.21709497980657277, -0.0798292587676198]]],
 [[[-0.3823903704536481, -0.28049582778205767],
   [-0.19097089083917709, -0.11844154488740925],
   [-0.34096355178295989, -0.037706868672806419],
   [-0.67627818265832562, 0.060123423646052034]],
  [[0.38482196336643348, -0.199256341514045],
   [0.15648539353690236, -0.19402518556684664],
   [-0.681716476221662, 0.21329975008874591],
   [-0.64202007514548087, -0.52566313690085176]],
  [[-0.30425417206475325, -0.10148405261897496],
   [-0.14220584843721412, -0.21027221173414662],
   [-0.93345568401731926, -0.31234983297537544],
   [0.27575221336809841, -0.097777800408836671]]]],
 [0.38673306652623135, 0.18022360244628727],
 [[[[0.16693990056788249, 0.0015475165700910508],
   [0.34571992334610763, 0.18308571802932649]],
  [[0.24206847228500439, -0.023586811148726235],
   [0.34176770880489438, 0.075298102594376914]],
  [[0.27653536536093715, -0.028802445057960081],
   [0.2858586682924848, 0.1874435928641609]]],
 [[[0.23248094516179421, -0.015442145779732434],
   [0.096020116767717725, 0.083229970514163018]],
  [[-0.64251432588054835, -0.048251152954441413],
   [-0.27497344890722514, -0.32962749438751648]],
  [[-0.39263109922059397, -0.17246887490264759],
   [0.40663212109032637, 0.28904082975498258]]],
 [[[0.24300082024517353, 0.16445529806524162],
   [0.38176060609278517, 0.077995514400432439]],
  [[-0.55451129673549948, -0.16631083693004073],
   [0.73890955022499893, 0.46389735634106749]],
  [[-0.11168798727325056, 0.053179616739449778],
   [-0.063903120680168748, -0.10772130860062085]]]],
 [0.16679874269081002, 0.073029980032166472],
 [[[[0.17857480320547131, 0.055489304100102534]],
  [[-0.070967634588418579, 0.06671859229710593]],
  [[0.28688495711856177, 0.09845254521509933]]],
 [[[0.43057202932291705, 0.40305420256379226]],
  [[-0.020528637581950705, 0.054201193249077587]],
  [[0.51125218226687641, 0.47174512158119464]]]],
 [0.090630712321444123, 0.15091955208615457],
 [[[[-0.11283426241241533, -0.11945602397314675]],
  [[0.003607831982804469, 0.21350861089011031]],
  [[-1.3660122211103582, 0.11369213614444701]]],
 [[[0.17244638378116825, 0.012389496625394339]],
  [[-0.12916684792544175, 0.39330249756008429]],
  [[-0.84111785286051433, -0.28305753178422516]]],
 [[[-0.0890081448794411, -0.024882586326127169]],
  [[0.098798078911032233, 0.20305822005247451]],
  [[-0.12951696660362025, 0.29660085973149242]]]],
 [0.26232429316648265, 0.25054690469672114],
 [[[[-0.0342720813346633, 0.12619712733732391],
   [0.023536289205377991, 0.099266661199769068],
   [-0.053537296727474988, -0.28035955708499977],
   [0.1171963674764295, 0.012025569877024149]],
  [[0.58149892676229376, 0.10644074364504799],
   [0.57514770374431778, 0.054990780599056932],
   [-0.075915031150783477, 0.32810411525033645],
   [0.23534943433643224, 0.21643664141873106]],
  [[-0.23747375902234996, -0.069873003727418059],
   [-0.1460571892090077, 0.081149347501359451],
   [0.34887902674442484, 0.10595180274408879],
   [-0.08606796407927092, -0.067420792736718443]]],
 [[[0.049506068906264321, -0.061937683874960243],
   [0.074639018256547882, 0.15071287588966453],
   [-1.0406417649906439, -0.62142629462985277],
   [-0.33761397576616886, 0.21189129766741172]],
  [[0.11815628547307204, 0.012880433355941922],
   [0.02530421340499402, 0.0084496032581453055],
   [0.12634118842396472, 0.17533125498723939],
   [0.33239313937720216, -0.038761858662295527]],
  [[-0.20250467369958192, 0.077480064090198919],
   [-0.14311955908332591, 0.077048696844647074],
   [-0.098038146772511048, 0.20238916564789391],
   [-0.096456218435678712, 0.017921407909595323]]],
 [[[-0.16622498828321577, 0.083278138105657026],
   [-0.058260734498653481, -0.0096197531151613822],
   [0.60828018497762659, -0.52330699668590963],
   [0.062937358107900965, -0.022568925780452605]],
  [[-0.14020523305791471, -0.003980658310715683],
   [0.02686880058053244, -0.15775258324850852],
   [0.35026169047554423, -0.22717117433103146],
   [-0.0848758804590397, 0.14886884434210429]],
  [[-0.31470560778690715, -0.20388415110652369],
   [-0.29344694288868739, -0.2500161624022178],
   [0.404921670825169, 0.093427852380711413],
   [-0.24507123565904029, -0.087058522642247851]]]],
 [0.20652399809837782, -0.038479626629931575],
 [[[[-0.42836467533854328, -0.16162879855605286],
   [0.14372402672892007, 0.10646525928026064]],
  [[0.58740138233942651, 0.054373952948019416],
   [-0.35223174436948718, -0.035022382520321818]],
  [[-0.49329205476300786, -0.21167686536319633],
   [-0.27573113649759889, -0.092983888701890352]]],
 [[[-0.4521916342017398, -0.20615618372239383],
   [-0.31799840887491215, -0.14793499951595138]],
  [[-0.17023303740212392, -0.0052072612395381856],
   [-0.88684291646843594, 0.083789052900783825]],
  [[-0.41120732299695184, -0.27101505591506303],
   [-0.37573276677337913, 0.034773340225433547]]],
 [[[-0.49173352915178736, -0.24129125393366119],
   [0.48262568952263335, 0.31982412533217214]],
  [[-0.436930588039649, -0.11625660018230079],
   [-0.54642444290607306, -0.34751750656094454]],
  [[-0.51319772784989093, -0.24756705661592371],
   [-0.24943915761962629, 0.08394726432476754]]]],
 [0.42632993247721723, 0.22099964139905343],
 [[[[0.202325684288428, -0.21464835523899126]],
  [[-0.0843389699546112, 0.062218719175255031]],
  [[0.25503164812033013, 0.033453392797624326]]],
 [[[-0.5101523008245, -0.67496901478093418]],
  [[-0.14191145860066084, 0.056034123985378666]],
  [[-0.41680184377763946, 0.25380233236814559]]]],
 [0.26063349348090253, 0.083988355156938657],
 [[[[0.0043792481461008611, 0.044022609762376139]],
  [[0.053340754744232423, -0.24809624400726066]],
  [[-0.031715810006907354, 0.090523770136180987]]],
 [[[0.15891145271161602, 0.0098536395216928634]],
  [[0.030184809958607863, 0.26667709707836257]],
  [[-0.84989860735574674, 0.24440342063748186]]],
 [[[-1.2485518052966416, 0.28020913239975537]],
  [[0.0028639431709443432, 0.19161403895418355]],
  [[-0.17881363538168885, 0.26983038531619435]]]],
 [0.16748113425977518, 0.40768074631179663],
 [[[[0.2688484253095822, 0.22610789678694646],
   [-0.09658435838980392, 0.2749229396579197],
   [0.45373200384266155, 0.1174652649733967],
   [0.02524010765979429, -0.32515349099645208]],
  [[0.067511559680369509, -0.33247717080895489],
   [-0.05604934901503112, -0.15363483049716053],
   [0.5230302265381398, -0.028951477214725924],
   [-0.36266005337177826, -0.055735897466926275]],
  [[0.39734748946999843, -0.10131270619004114],
   [0.074375416975047612, 0.0845324886286225],
   [-0.38543068804554381, -0.20961195375100311],
   [0.13276555610056823, 0.12071989487474136]]],
 [[[-0.24253278123190888, 0.29597825844714959],
   [0.11389416389019552, 0.28643177499912015],
   [0.19535305040344964, 0.0022986289350796804],
   [0.13184671832246647, -0.27755906354020793]],
  [[-0.21946028296375988, 0.26173985702563807],
   [-0.14274242257150085, -0.076444781179688448],
   [-0.22339689266901994, -0.2420445031796423],
   [0.21764394391679562, -0.039223566492580089]],
  [[-0.6141502659207706, -0.071421677244615123],
   [0.073438648595556072, 0.069846704740173057],
   [-0.26898843242575443, 0.95557332692870356],
   [0.27503291722521117, 0.10506849129624989]]],
 [[[-0.19080742809458856, 0.36705521887029763],
   [-0.18217414053126393, 0.16987592576017371],
   [-0.45185471652659182, 0.88702616108364962],
   [0.18845122667263736, 0.032999657469719522]],
  [[0.16110307747071345, 0.30092107893343084],
   [0.10418287833097097, 0.19196593092692454],
   [-0.23676609091556056, -0.24247527490567675],
   [0.084148050509976813, 0.041228888652727141]],
  [[-0.48121034856644374, 0.12335083841820242],
   [-0.25756601604530455, -0.070772550150947688],
   [-0.3698072710670367, -0.14800686993939949],
   [0.1997631841219438, 0.24609968988796552]]]],
 [0.1830149862169009, 0.16535251911471183],
 [[[[-0.27384637761722108, -0.033579773293449147],
   [-0.45754149859555326, -0.0792034638884923]],
  [[-0.39654241989915018, 0.17718829967043537],
   [1.0143646876455505, 0.54197744619697219]],
  [[-0.084062138392596922, 0.087869863669814932],
   [-0.16376088205341507, -0.06483081210400278]]],
 [[[-0.12800366134480923, 0.05121915206508406],
   [-0.47323506274471083, -0.075880169373113635]],
  [[-0.24914488353886416, -0.17837187442948893],
   [-0.15854715122361085, -0.2856362909896743]],
  [[0.27888101920013691, 0.12935602184386052],
   [0.28593488499663172, -0.0548584118318113]]],
 [[[0.275550769755242, -0.038937170054796286],
   [-0.30592763630831304, -0.17772174281955652]],
  [[0.15462861313289453, -0.13600216189736131],
   [0.14229915793934206, -0.08013239010272323]],
  [[0.11107771723044862, 0.12288026751785845],
   [0.014505162430090852, -0.061952455112030624]]]],
 [0.19557842206057166, 0.19716475304544881],
 [[[[0.16150198260256493, -0.2488244355513004]],
  [[-0.065343708268163575, -0.056102064418021687]],
  [[0.10243063763916412, -0.26171375761833776]]],
 [[[0.036221543978988774, -0.20517700431219629]],
  [[0.12829384346966063, -0.1289466566734718]],
  [[0.10282036745076054, -0.051216299892230178]]]],
 [0.18998890901917764, -0.11937829507532459],
 [[[[-0.074569224728571554, -1.1814622862287982]],
  [[-0.0065604036041783916, -0.028499522538892798]],
  [[0.130582341578531, 0.039529670183011276]]],
 [[[0.19477545121782938, -0.969758336868715]],
  [[0.26747263677311889, 0.020906309480636331]],
  [[0.38743309736348158, 0.15803219972991298]]],
 [[[-0.31235889209188561, -0.12966636023578842]],
  [[0.0626857336071743, 0.074901166137588765]],
  [[0.010134575553489353, 0.035947840444549933]]]],
 [0.12063884844693674, 0.29393905992324237],
 [[[[0.12307709741435055, 0.0076869004297793805],
   [-0.24689368315086724, 0.014780981957117807],
   [0.012587030513765061, -0.15855150015512956],
   [-0.3196072398108088, -0.11954235883803249]],
  [[0.2472578984281642, 0.036226557650611182],
   [-0.17748776602821054, -0.13143622147705586],
   [0.075394658604974032, -0.22558154740409708],
   [0.075070256625406881, -0.066335955801580443]],
  [[0.13010631651190055, -0.24792627930584119],
   [-0.21438156703653519, 0.013777065217566277],
   [0.16037518679965229, -0.077518863056019835],
   [-0.038401223831646777, 0.55647499129336941]]],
 [[[0.15250603257041523, 0.040510916162449957],
   [-0.22137017981839643, 0.020394979462134751],
   [-0.060344896205597978, -0.0086775653272068778],
   [-0.20298397138318858, -0.11299512273558028]],
  [[-0.035167953041775071, -0.04985762923324679],
   [-0.11960106675051607, -0.0072348985205586188],
   [-0.010436024999025798, -0.33062786902532326],
   [-0.033691177125668721, 0.1280659969097325]],
  [[0.11269612234318377, 0.18877679390877142],
   [-0.078463911271659248, -0.022916673548803685],
   [0.16457519930555237, -0.14362551454879538],
   [0.14986808913042454, 1.0628446881687463]]],
 [[[0.092307130983058538, 0.024021682485418843],
   [-0.18659899110337283, -0.011102131674240715],
   [-0.189664362845031, 0.019035510471659186],
   [-0.25831839066993345, -0.17365026722294694]],
  [[0.047808038926433129, 0.13740904073838023],
   [-0.066229320252753368, -0.17042867265880274],
   [-0.036558260772994011, 0.059013175682479983],
   [0.18867296289729696, -0.23176801660946236]],
  [[0.078467020908780244, -0.10580807005590556],
   [-0.183635303111866, -0.086813266083939383],
   [-0.028082062181538615, 0.13116259488291529],
   [0.65877962073532992, 0.28289175563783642]]]],
 [0.20542892656773998, 0.14103760216859318],
 [[[[0.21015987930929295, 0.12436349679747456],
   [-0.11316974046086935, 0.020380022506098834]],
  [[0.24752541909607689, -0.10110797246268423],
   [-0.057491039995547319, -0.069587569766777588]],
  [[0.29737453110612239, 0.0012927761967250209],
   [-0.12563271982454888, -0.034726464654286048]]],
 [[[0.038160740592244807, 0.074683697876577554],
   [-0.0018059121234719779, -0.050590141333391785]],
  [[0.42774283824022064, 0.0820713190719911],
   [0.74668573682191308, 0.2213002004419285]],
  [[0.13795194916346845, 0.060629769114199976],
   [-0.093272344531398321, -0.0285946844085204]]],
 [[[-0.07133568680576928, 0.048846880394349625],
   [0.084386827212454649, -0.11846097403062575]],
  [[-0.16360666983511751, 0.014553870083485852],
   [1.0304575518006296, 0.37628453098722719]],
  [[-0.045417775862988653, -0.034019198527150206],
   [0.04109288978143983, -0.086857714388111934]]]],
 [-0.046950338386243212, 0.1469306714677826]]
))
# Prepend the step size as we did not train it.
weights.insert(0, tf.constant(0.1, dtype=tf.float64))
# Also insert beta.
# infer is going to rewrite beta using mcmc's methods.
weights.insert(1, tf.constant(beta,dtype=tf.float64))

hmctrain.run(conf, mcmc, loss, opt, weights)
