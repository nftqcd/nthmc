import tensorflow as tf
import tensorflow.keras as tk
import nthmc, ftr, hmctrain
import sys
sys.path.append('../lib')
import field

conf = nthmc.Conf(nbatch=64, nepoch=2, nstepEpoch=256, nstepMixing=64, nstepPostTrain=1024, initDt=0.1, stepPerTraj=20, nthr=32, nthrIop=2)
nthmc.setup(conf)

# using the exact model from t_force_b25_0.py, except for trainable=False in TransformChain

op0 = (((1,2,-1,-2), (1,-2,-1,2)),
       ((1,1,2,-1,-1,-2), (1,1,-2,-1,-1,2), (1,2,-1,-1,-2,1), (1,-2,-1,-1,2,1)))
# requires different coefficient bounds:
# (1,2,-1,-2,1,-2,-1,2)
# (1,2,-1,-2,1,2,-1,-2)
# (1,-2,-1,2,1,-2,-1,2)
op1 = (((2,-1,-2,1), (2,1,-2,-1)),
       ((2,2,-1,-2,-2,1), (2,2,1,-2,-2,-1), (2,-1,-2,-2,1,2), (2,1,-2,-2,-1,2)))
fixedP = (1,2,-1,-2)
fixedR0 = (2,2,1,-2,-2,-1)
fixedR1 = (1,1,2,-1,-1,-2)
convP0 = lambda: ftr.PeriodicConv((
    tk.layers.Conv2D(2, (3,2), activation='gelu', kernel_initializer=tk.initializers.RandomNormal(), bias_initializer=tk.initializers.RandomNormal()),
))
convP1 = lambda: ftr.PeriodicConv((
    tk.layers.Conv2D(2, (2,3), activation='gelu', kernel_initializer=tk.initializers.RandomNormal(), bias_initializer=tk.initializers.RandomNormal()),
))
convR = lambda pad: ftr.PeriodicConv((
    tk.layers.Conv2D(2, (3,3), activation='gelu', kernel_initializer=tk.initializers.RandomNormal(), bias_initializer=tk.initializers.RandomNormal()),
), pad)
conv = lambda: ftr.PeriodicConv((
    tk.layers.Conv2D(2, (3,3), activation='gelu', kernel_initializer=tk.initializers.RandomNormal(), bias_initializer=tk.initializers.RandomNormal()),
    tk.layers.Conv2D(2, (3,3), activation=None, kernel_initializer=tk.initializers.RandomNormal(), bias_initializer=tk.initializers.RandomNormal()),
))
transform = lambda: ftr.TransformChain([
    ftr.GenericStoutSmear(((0,0),(2,2)), op0, [(fixedP, convP0()), (fixedR0, convR((1,2)))], conv()),
    ftr.GenericStoutSmear(((0,1),(2,2)), op0, [(fixedP, convP0()), (fixedR0, convR((1,2)))], conv()),
    ftr.GenericStoutSmear(((1,0),(2,2)), op0, [(fixedP, convP0()), (fixedR0, convR((1,2)))], conv()),
    ftr.GenericStoutSmear(((1,1),(2,2)), op0, [(fixedP, convP0()), (fixedR0, convR((1,2)))], conv()),
    ftr.GenericStoutSmear(((0,0),(2,2)), op1, [(fixedP, convP1()), (fixedR1, convR((2,1)))], conv()),
    ftr.GenericStoutSmear(((1,0),(2,2)), op1, [(fixedP, convP1()), (fixedR1, convR((2,1)))], conv()),
    ftr.GenericStoutSmear(((0,1),(2,2)), op1, [(fixedP, convP1()), (fixedR1, convR((2,1)))], conv()),
    ftr.GenericStoutSmear(((1,1),(2,2)), op1, [(fixedP, convP1()), (fixedR1, convR((2,1)))], conv()),
], trainable=False)
ftr.checkDep(transform())
rng = tf.random.Generator.from_seed(conf.seed)
loss = lambda action: nthmc.LossFun(action, cCosDiff=0.0, cTopoDiff=1.0, cForce2=0.0, dHmin=0.0, topoFourierN=1)
opt = tk.optimizers.Adam(learning_rate=0.001)
beta = 6.0
mcmc = lambda: nthmc.Metropolis(conf, nthmc.LeapFrog(conf, nthmc.U1d2(beta=beta, beta0=4.0, size=(16,16), transform=transform(), nbatch=conf.nbatch, rng=rng.split()[0])))

# Get the weights from the end of the epoch with beta=5
# <ssam -n '/^beta: 5$//done training epoch/?^weights?;/^[^ ]/-' t_force_b25_0.log|grep -v '^$'
# Edit x/ +[0-9\-]/s/ /, /
# Edit x/[^,]$/a/,/
weights=list(map(lambda x:tf.constant(x,dtype=tf.float64),
 [[[[[-0.31345247279277572, 0.032361920141260159]],
  [[0.017674883075901815, 0.048906158400611764]]],
 [[[0.35862671746354252, 0.03999488206734518]],
  [[-0.14948784540940716, 0.30577798330751071]]],
 [[[-0.20095037651005337, -0.71474576278192081]],
  [[0.10061539650100627, -0.88743657548936716]]]],
 [0.18733198272835563, 0.15156236185556493],
 [[[[-0.54856873952160112, -0.84084080585537857]],
  [[-0.88054177824695345, 0.16662342278033726]],
  [[-0.038754465075445381, -0.18788330554773347]]],
 [[[-0.010876732145980426, 0.13733465509488227]],
  [[-0.23794355786193414, -0.10692191992745227]],
  [[0.089131733183688361, 0.066998859439881375]]],
 [[[-0.30876683452853515, 0.10347374830923085]],
  [[-0.091630140838775576, -0.19115241790300455]],
  [[-0.084718741685128843, 0.0490511626488262]]]],
 [0.1831773987267834, 0.12185457155580025],
 [[[[0.1443604746440012, 0.031885880007246362],
   [-0.25803738105064322, 0.36580880685976142],
   [-0.043049036074868513, -0.034020403257807155],
   [-0.032566869106418907, -0.1363755296295219]],
  [[-0.27276489842698554, 0.13005635830089565],
   [-0.28591891344587617, 0.083947166038272944],
   [-0.10064261988604618, -0.04895066535731489],
   [0.20437371771927904, -0.053339761458072579]],
  [[-0.29831931546535878, -0.084817024136195393],
   [0.28126017596944847, -0.031672998038130729],
   [0.060756705872359353, -0.035879493856824207],
   [-0.02298886116723799, 0.056250385901437154]]],
 [[[-0.20189789058159119, -0.1007729615047397],
   [-0.35545865161378348, -0.61571841888351164],
   [-0.16417538132308146, 0.11060618864468977],
   [-0.05605178761268477, 0.0051832469702881127]],
  [[-0.019239361396572782, -0.57152230072943111],
   [-0.020123148266309478, -0.42706061013206953],
   [-0.26054743489553367, -0.289258925301992],
   [-0.050090133113681115, -0.025178733513598079]],
  [[-0.024669874221532089, -0.018931250618315305],
   [-0.54227075096912791, -0.10641408585564703],
   [-0.35911215537807728, 0.031035341686412421],
   [-0.24943409783093892, 0.0028032831618352216]]],
 [[[0.23211759612018312, -0.0093078485880055],
   [0.10580193768858162, 0.237103370054831],
   [-0.14494308460598399, -0.17707222041052673],
   [0.18816092607320231, -0.013098827941977861]],
  [[-0.30739052869156175, 0.23777512382810995],
   [-0.12352445639912518, 0.21537121375628446],
   [0.35863179964400776, -0.620177658883029],
   [-0.462392515513082, -0.40795785154627312]],
  [[-0.17561094220127008, -0.0080173928817286588],
   [0.37400991778538983, -0.027939297956394368],
   [0.036087545886807751, -0.071172878388565217],
   [0.6690541973578088, -0.17599036479374219]]]],
 [-0.12360932452588258, -0.23996806934795134],
 [[[[-0.077668465931565345, 0.36887734027284841],
   [-0.68329714098526551, -0.30360484584565528]],
  [[-0.37211200516176723, -0.40494577878063931],
   [-0.56452778065988141, -0.091422166441686756]],
  [[-0.80698242842139167, -0.074882504115915724],
   [-0.47983334484946238, 0.075530485172968287]]],
 [[[-0.89857088067160928, -0.24383266327667233],
   [0.07733710991037511, 0.11093529182618805]],
  [[0.3715702932527099, 0.97041035850578972],
   [-1.0012530079949409, -0.43912382158386803]],
  [[-1.0815858005642811, -0.19180892250601914],
   [-1.1730672250779111, -0.447846643171771]]],
 [[[-0.93157530017521728, 0.17141948283478725],
   [-0.74209279413993856, -0.25432860793947537]],
  [[-0.94537856784207985, -0.31373552261096394],
   [-0.76246280531773714, -0.19296664302588309]],
  [[-0.94827938412766144, -0.062758045624763156],
   [-0.7679389321056671, -0.05716813211647865]]]],
 [0.713199911877876, 0.32000684694376147],
 [[[[0.54828394188637009, 0.34375601733563715]],
  [[0.1151276057787599, 0.49937328348136456]]],
 [[[-0.088936531245248182, 0.29849658316307254]],
  [[-0.516636275726314, 0.011692952223272718]]],
 [[[0.45516957318896539, 0.21869557224551728]],
  [[-0.11662682715027656, 0.41690322213292147]]]],
 [0.36873498473049332, 0.25102644611040403],
 [[[[0.017162773757632935, -0.025354877247642335]],
  [[0.43124848519066539, -0.0062587614618833561]],
  [[-0.20566676174645421, 0.11444671802097778]]],
 [[[0.42199590210076288, 0.0037514280581263972]],
  [[0.42978189441427006, -1.2343942463341522]],
  [[0.28113241710260739, 0.27685741234166356]]],
 [[[0.21404366416554871, 0.08041990119562531]],
  [[0.2364343639827178, -0.03555322644974547]],
  [[0.2240921357155945, 0.11626652612973214]]]],
 [0.22191465640270822, 0.069088745583470459],
 [[[[0.4428133565797554, 0.0926361744033866],
   [-0.056364276262526214, 0.047119491334168581],
   [0.14084411358122612, -0.04136497656116217],
   [0.31828227940617065, -0.062864645533348182]],
  [[-0.05616320925847236, -0.24916413040050481],
   [-0.39858946753134206, 0.132223211316922],
   [0.17403643399077959, -0.21820379524665587],
   [-0.52967289797378525, 0.47135302918927807]],
  [[-0.29587952326906514, 0.043828138965120271],
   [0.097359633456115577, 0.2224206017019249],
   [0.19520879356709597, -0.24508879961688687],
   [0.28042449344938764, -0.023997820442818105]]],
 [[[0.0452863513408037, 0.082149936114874547],
   [-0.22969450726546575, 0.29735609948723946],
   [-0.1523370673008454, 0.16652018994832163],
   [0.181991498245451, -0.11873829931436461]],
  [[0.048619629672788482, 0.44267632482137925],
   [-0.39019409706539832, 0.33267626256642813],
   [0.32049818015647608, -0.44901831567162326],
   [-0.15515187131906225, -0.726085067183856]],
  [[-0.47296191128143866, -0.010970937388347942],
   [-0.47188261959889954, -0.10554004763106747],
   [0.074703358582170712, -0.060703432108487276],
   [0.10965431243402489, 0.59301509167353239]]],
 [[[0.21380654686633122, -0.12048932512893727],
   [0.012643744505377344, 0.11276704232906944],
   [-0.0564910345253106, -0.031740399352740832],
   [0.18397773894953787, 0.065871190917588113]],
  [[-0.14071357767908169, 0.13676242288540288],
   [-0.19894220293887671, 0.06924758921714895],
   [0.1013751465178422, 0.081092901656295513],
   [0.38880569743696775, -0.09977281558262896]],
  [[-0.13742538947103713, 0.18378570650207762],
   [-0.080959096286784424, 0.12845466703352276],
   [-0.11157946680411437, -0.20526212522889606],
   [0.10886562735827847, 0.69821797251910012]]]],
 [0.017464114500711926, 0.26788627382912061],
 [[[[-0.30644405534537389, 0.078643231169113773],
   [0.7012695895346851, 0.18325923577821754]],
  [[0.32186687286107313, 0.14119397136279582],
   [-0.10294684953884743, 0.06348198705855311]],
  [[-0.40056003925209371, 0.045210622928705362],
   [0.08125421088753991, 0.039979166842710183]]],
 [[[-0.25720686989868841, 0.11953444274548343],
   [1.2011010862424156, 0.13541112846027231]],
  [[-0.36557339771961744, 0.38957057148961416],
   [0.088951099243227347, -0.27720541900948753]],
  [[-0.34699496397405133, 0.082894024378387124],
   [0.0257247784847042, 0.00669751519387175]]],
 [[[-0.11595514939927443, 0.089682567694955612],
   [0.015848174573684263, -0.13009046925300241]],
  [[-0.1711903175352536, 0.40849379976255751],
   [0.75147237380723542, 0.30225268350451073]],
  [[-0.40843727808358765, 0.037289871999908852],
   [0.041166785410659906, 0.037227006505900037]]]],
 [0.46667797269395384, 0.16149644022786369],
 [[[[-0.50275978466537, -0.635067802970899]],
  [[-0.28249636721376431, -0.47720209429596067]]],
 [[[0.17791083420603479, 0.30222589765765812]],
  [[0.082173567180861593, 0.31328598820228432]]],
 [[[-0.017719453374116088, 0.22431235744679925]],
  [[-0.037433589248322637, 0.081086030065091727]]]],
 [-0.25146216993404319, -0.036264120685586217],
 [[[[0.015853306220345413, -0.11102230774578736]],
  [[0.014758819868654696, 0.0028498258604685474]],
  [[-0.037645273137407523, -0.081410139972442647]]],
 [[[0.0207790706971298, -0.0014473026670025328]],
  [[-0.84767348031777368, 0.026292654079151122]],
  [[-0.55927946217766566, 0.015868242959716533]]],
 [[[0.041844632775422275, 0.05407957878173645]],
  [[0.041556043072095761, 0.078176337395289786]],
  [[0.009308202542075223, -0.18556669141488757]]]],
 [0.22702018310432742, -0.19640956860650238],
 [[[[-0.11884788154336856, -0.23074439891926565],
   [0.34243094665990115, -0.1502299432391237],
   [0.10969301139267021, -0.10068066930799061],
   [0.078527928444403969, 0.17223852226623212]],
  [[-0.24538132684819672, -0.21758027831791193],
   [-0.31836010945224597, -0.19207384803058988],
   [-0.019028175922404276, 0.089562698316479811],
   [0.06462172920347288, 0.081595047429651554]],
  [[-0.56958493152747447, -0.062065157861325486],
   [-0.37606913394140934, 0.075465166551051538],
   [-0.19564480255965791, 0.10385466340472942],
   [-0.020002595408106484, 0.02884704974961614]]],
 [[[-0.43927346284288848, -0.20386183871807589],
   [-0.38416880901704265, 0.027221580314714632],
   [0.23009106629595594, 0.147983930831534],
   [-0.065388568129101529, 0.068402342483247086]],
  [[-0.253681008047795, -0.052278130466434487],
   [0.192633662964341, -0.033595535692614018],
   [0.66197742221117628, -0.030624890193800693],
   [-0.3191746526342758, -0.076872719976075379]],
  [[0.25768265172481863, -0.22529719036060714],
   [0.76663205155729841, -0.16849697029499847],
   [0.49024597965560024, -0.26850969054371232],
   [-0.20810388759091586, -0.039063946584847048]]],
 [[[-0.0027043078808079318, -0.15040434787485296],
   [0.27531431442014292, -0.12388479477477962],
   [0.46613649085135, 0.67619285211992164],
   [-0.24919176117831895, -0.15015163122299297]],
  [[-0.22696684866365596, -0.12108328040515309],
   [-0.25722978728505019, -0.1482291994569693],
   [0.37445381298835667, 0.563002643523487],
   [-0.35607813003271482, -0.26829703854096204]],
  [[-0.62761169496970093, -0.037411506826206704],
   [-0.54219716953366215, 0.12113605042530277],
   [0.0787822847836928, 0.23779686910723363],
   [-0.22758294907512572, -0.16532497530578694]]]],
 [0.31615401022376444, 0.18493497518635513],
 [[[[0.32199303485494263, -0.078584118707874753],
   [0.46292424406947363, 0.15166750189771136]],
  [[0.4226227952836481, -0.019415003492298983],
   [0.56524886570484245, 0.22529306290791812]],
  [[0.41975319511445258, 0.11287744373549449],
   [0.33261279203810795, 0.27390254559390814]]],
 [[[0.57964821083143947, 0.46199336646650763],
   [-0.00058190372927761328, -0.23945776884551268]],
  [[0.94796669266385369, 0.29529537069547313],
   [0.6151044294695448, -0.0024414642999809628]],
  [[0.052078159751971588, -0.26945278146377744],
   [0.16372497971334654, 0.093545845068900776]]],
 [[[0.29565489011149149, -0.18253879589921063],
   [0.27189953521596116, 0.12341725117769559]],
  [[0.12655311741173467, -0.17322550836534972],
   [0.098667952555481026, 0.0071908176566804058]],
  [[0.19987075850816141, 0.16283483047351532],
   [-0.0203008211936194, -0.01881557224372693]]]],
 [0.1504153896821453, 0.04704136240977877],
 [[[[0.092451593239817179, 0.094894877871349759]],
  [[0.70910261020369048, -0.042960773695375425]]],
 [[[-0.39029296512090939, 0.16542385633170184]],
  [[0.027001251020499523, 0.2248764246015636]]],
 [[[0.20215607675837058, 0.10474676245466767]],
  [[0.52882751745811474, -0.14716905384797838]]]],
 [0.23397777429707484, -0.25820498658695834],
 [[[[0.011857894706151806, 0.0091110167309609632]],
  [[0.476974351971536, -0.041447771603027074]],
  [[0.09812928644197022, 0.044401307901898737]]],
 [[[-0.088542767293322347, -0.03523079513174724]],
  [[0.25798544923839728, -0.89434719414031072]],
  [[0.023448871522443449, -1.2097716593165957]]],
 [[[0.018505012747437582, 0.023565660787195502]],
  [[0.15632664782934291, -0.061914758669065317]],
  [[-0.10770334307508431, 0.079628840234023571]]]],
 [-0.0861841186310048, 0.10178551737250432],
 [[[[-0.071530865275739569, 0.07963111217726708],
   [-0.16747688933680374, 0.0010791199490281177],
   [5.4035549300365109e-05, 0.1969951259039654],
   [-0.33338802534005224, 0.5707095322378235]],
  [[-0.12560350468129353, -0.26808874824708506],
   [-0.28076176452438611, 0.11113467048662902],
   [0.098913876452356511, -0.12968617827877069],
   [-0.013651906153849111, 1.1691405309719138]],
  [[-0.061858439294889947, 0.024691508362304295],
   [-0.33679447449275729, -0.19755773491323908],
   [0.057229056194514606, -0.11378947508963307],
   [0.18772713645989697, 0.29904269092820268]]],
 [[[0.12696097425976366, 0.058574326174242609],
   [-0.72429225352119464, 0.084852189412043019],
   [-0.1170796750840073, -0.097949302455375156],
   [-0.49318626440680619, -0.072202695934966088]],
  [[-0.069419269591185953, 0.047466380410126366],
   [-0.2030193319088088, -0.44928912385878989],
   [0.50948813054767139, -0.4628567072653314],
   [-0.36841921338129596, 0.15590429029272304]],
  [[-0.28149831688118615, 0.58911334879052024],
   [-0.11218740885959662, -0.54444956935911093],
   [0.020860275981387198, -0.31829769541090436],
   [-0.053701919996887955, -0.094809308941025253]]],
 [[[-0.10858001879928124, 0.11686468038266404],
   [-0.017772293403401043, -0.063129636832571528],
   [0.0700913336981934, 0.035859362447261574],
   [0.21730360558484302, -0.027529891601117219]],
  [[0.067481972231149087, -0.058747208878719981],
   [-0.31252912581474707, -0.11432518345127436],
   [0.32191877820081771, -0.030028184994356256],
   [-0.15763125401253569, -0.080140020557223135]],
  [[0.14523027749749451, 0.079133320842611682],
   [-0.28423832733162557, -0.22206068051088065],
   [0.074217706533310238, -0.055644406669173162],
   [0.011942639961091088, 0.0877630249578248]]]],
 [0.122515555047492, 0.33456183917833987],
 [[[[0.024043869163872016, -0.075933948649720362],
   [0.057716048858923161, 0.032761403483388109]],
  [[-0.070636598427963354, 0.14261538751706079],
   [0.028468045241652057, -0.016235783032011078]],
  [[0.39320374684160619, 0.24334866607750136],
   [0.030898588324630143, -0.048244586391548876]]],
 [[[0.12961488831073786, 0.291472575378225],
   [0.10610257939011089, -0.0431412436349744]],
  [[-0.51645431783093387, 0.36625732966530444],
   [0.40956813453787738, -0.020936399525427096]],
  [[0.10106844341133189, 0.087891605647251361],
   [-0.030335773729836545, -0.037700915801254238]]],
 [[[-0.047838773086820066, 0.28858104524421352],
   [1.0724269823498498, 0.39661030859369351]],
  [[-0.50728655085040253, 0.32134087196644823],
   [1.1379471918662583, 0.34618144698940234]],
  [[-0.1706143459228662, 0.11602281082071395],
   [0.14832356957712586, -0.014184288017295734]]]],
 [0.43881959584050689, 0.12088938027446271],
 [[[[-0.12444722271910048, -0.20232289954780922]],
  [[-0.13487129191672731, 0.51918704440865571]],
  [[-0.16639583022096258, 0.27980834675656663]]],
 [[[-0.25068563793164428, -0.7479663259575573]],
  [[-0.19136961783017178, -0.333908685363548]],
  [[-0.1778114787273351, 0.1328649912526326]]]],
 [-0.51200169575037968, 0.082525885549733433],
 [[[[-0.0648963505839476, 0.059860136717068815]],
  [[0.0027245700880282786, 0.11506914787826826]],
  [[0.16021274794769363, -0.26388155900085186]]],
 [[[0.20275793976626813, 0.060489288529551231]],
  [[0.0361611908543447, -0.11432181464828624]],
  [[0.390716129715116, -1.4100712782536668]]],
 [[[-0.095856639457284135, 0.054690605428952724]],
  [[0.15525084718408261, -0.046649485519181154]],
  [[0.31646776680134325, -1.0612934799362341]]]],
 [0.076685624221765766, 0.17015082348171856],
 [[[[0.22345089462203857, -0.02803873327812741],
   [0.1499715193163268, 0.5876272347493513],
   [-0.045237894128222191, -0.42947594318300542],
   [0.005458318042456574, 1.0868351150678321]],
  [[0.25090807955720057, -0.22600402369543082],
   [0.17511795355536736, 0.33509744807353292],
   [-0.063032438752796641, -0.134772493443153],
   [0.086165691286847812, 0.14580543264866602]],
  [[0.267269947381625, -0.25245857792900872],
   [0.061989751571141796, 0.4653630027849982],
   [-0.04772093155351257, 0.10433652779441427],
   [0.0920098692859982, -0.00015645170748260852]]],
 [[[0.1013330978587909, -0.094313419081887465],
   [0.16981129639985665, -0.4106518718852879],
   [-0.033431527783328946, -0.21373180763053398],
   [0.066967019604659839, 0.85547038436041267]],
  [[0.18406479319137251, -0.21651765874700138],
   [0.087130198635354969, 0.061644546689284152],
   [-0.13848300452909215, 0.070348919714960212],
   [-0.040346205195671295, 0.062067161908340739]],
  [[0.18402556336938092, -0.15086051621232791],
   [0.061222284004315411, -0.625605005109275],
   [-1.7277400116101442e-05, -0.20968627365600248],
   [0.031852756801511187, -0.023776731624716729]]],
 [[[0.26575088778063388, -0.30771463391520743],
   [0.089654751397056517, -0.54032469831185692],
   [0.0015321517525592157, -0.013539675466175309],
   [0.05686510228844948, -0.049191633705609687]],
  [[0.23458198563306112, -0.332633374144082],
   [0.14166813385302277, -0.17878847675482176],
   [-0.11613866062919644, 0.073933157337149613],
   [0.10808365237157375, -0.055079114240671287]],
  [[0.25122762470275373, -0.26396681114467196],
   [0.15464791032950134, -0.55926902581336069],
   [-0.16264013501042698, 0.16539139744025536],
   [0.0665902203683334, 0.019180455758092411]]]],
 [-0.24981492320570506, 0.23572875760744333],
 [[[[-0.24383463130388688, -0.21885779389725685],
   [-0.080654216867105916, -0.0028349357025389673]],
  [[-0.20237911388390051, -0.12931831620695391],
   [0.071078890914251139, 0.01947790938562045]],
  [[-0.29946924269269326, -0.023743855741934689],
   [-0.14432061008845948, 0.035891493954641626]]],
 [[[-0.23160660161997917, -0.071741052469753971],
   [0.2187720579391049, -0.089980734775648788]],
  [[-0.28539296086818994, -0.020204188412097163],
   [1.4263277932312752, 0.5816543623694389]],
  [[-0.341662421403393, -0.1766748826280865],
   [0.26370362334669256, -0.13901947459506256]]],
 [[[-0.313616164833838, -0.11400447436433803],
   [0.084865210115029455, -0.043196211428325818]],
  [[-0.31219839220829221, -0.20790674803922346],
   [0.72417743169593707, 0.19090035896379087]],
  [[-0.28577167876270476, -0.11088565879304482],
   [0.053871793601089686, 0.00078028933359912682]]]],
 [0.20708088098905506, 0.12175006212498862],
 [[[[0.16630527552046326, -0.28654903902072376]],
  [[-0.0960718441205767, 0.31487831225763568]],
  [[0.2158890001196915, -0.32833455132063472]]],
 [[[0.42719034255134725, -0.28607321146955472]],
  [[-0.646339242838348, 0.23663089389410549]],
  [[0.36846943765721057, -0.35716215263506557]]]],
 [0.19149112341316624, -0.11636910959814926],
 [[[[-0.3303574531079273, 0.093573946681564449]],
  [[0.082171412499624646, 0.12086016338383403]],
  [[0.05129785566579094, 0.084985150254002259]]],
 [[[-0.095249983837614072, -0.20581912344063172]],
  [[-0.085587043979395663, -0.73577977067330336]],
  [[-1.260800208987866, 0.07999096033186566]]],
 [[[-1.1876436509290755, -0.06093751257587296]],
  [[-0.11082095210647473, -0.049894636198860642]],
  [[-7.0909517630048709e-05, 0.0036008003912137848]]]],
 [0.21047445008252944, 0.30072292503122211],
 [[[[-0.18448615653320169, 0.0615323878465641],
   [-0.075534585929586992, 0.31350929023712004],
   [0.0660613544510872, -0.20537754305990136],
   [-0.17162992270756425, -0.23350527310593006]],
  [[0.29999871464968941, -0.090016050166170355],
   [-0.10332096857806941, 0.18936428204779418],
   [-0.25859406640283417, -0.34005444262039325],
   [0.22703637381323527, -0.26910556503232924]],
  [[-0.19909767806132211, -0.024988227258511287],
   [-0.078759530501298691, 0.17021464836467778],
   [-0.69726509970469253, -0.22454503738023487],
   [-0.23461218964981492, -0.15978727723090663]]],
 [[[-0.12199435723655949, 0.0871170916832734],
   [0.35919034110360976, 0.10018492598750062],
   [-0.65160203406226758, -0.31645617268748327],
   [-0.26639856446380716, -0.17555395840403157]],
  [[0.65723496878185328, 0.12842575640951276],
   [-0.60647267779859015, 0.28141862063515283],
   [-0.57652035417978442, -0.48495892466549806],
   [-0.70625366683064539, -0.12990611631292256]],
  [[-0.20754302753896078, -0.053630677026195818],
   [0.3280994311640994, 0.16889369675464139],
   [0.30596915866961538, -0.29547102322475177],
   [-0.647966710538646, 0.0034437235749302866]]],
 [[[0.096874716978017819, 0.095786235449852458],
   [0.32421143301384103, 0.10400586787802779],
   [0.12033176335246201, -0.17637770931268495],
   [-0.0060747552501668927, 0.050612119972419545]],
  [[0.17253160232621736, 0.069590025237133313],
   [-0.1503834412401448, 0.39484973069346796],
   [-0.30626179645816959, 0.31884960805884127],
   [0.614377023904914, -0.35564514234123051]],
  [[0.038075849213813032, -0.037935391113792467],
   [0.23837188801291226, 0.46227771614719776],
   [0.098616625725826662, -0.18576121858930492],
   [-0.039201112997074884, 0.31836424447693529]]]],
 [0.27321296329959555, -0.21544642026584113],
 [[[[-0.55810653898900953, 0.051088128531215991],
   [0.67339552891706911, 0.53169688412282579]],
  [[0.32445961033857373, 0.2189929205653508],
   [-0.70686588939602413, -0.551696220289904]],
  [[-0.48493578412125771, -0.071154977751534079],
   [-0.42666203223623939, -0.21715786391977493]]],
 [[[-0.49517639201110947, 0.55104098669258617],
   [-0.44144556604254326, -0.19561403335972646]],
  [[-0.51768043146407317, -0.144711527789567],
   [-0.90982028640746959, -0.2637820756017959]],
  [[-0.37936148379541684, 0.53411711340572854],
   [-0.47703997220721467, -0.22528165269339462]]],
 [[[-0.43389527069517797, -0.028095955819175608],
   [-0.20732564491906127, -0.21341667976908457]],
  [[0.4097879736590388, 0.10261710989685711],
   [-0.70885815094214322, -0.091542731122054341]],
  [[-0.52079126295195277, -0.047861432693245706],
   [-0.36630178097445459, -0.1219185283954921]]]],
 [0.50697365913919468, 0.21688794117328541],
 [[[[0.12266453565114317, 0.50381374313021654]],
  [[0.20150828567760018, -0.4191149426958054]],
  [[0.05329202900202204, 0.4434008799316394]]],
 [[[0.056069138052341934, -0.049181641055906972]],
  [[-0.0084935359434937258, 0.50866395321582925]],
  [[0.21915617211857308, -0.1648815421649274]]]],
 [0.11901555632705431, 0.23210344985760883],
 [[[[0.073767727155980067, -0.030753011022890849]],
  [[0.38227723152835, 0.32535677892413772]],
  [[0.096664667306531477, 0.50777342968895567]]],
 [[[0.17815656702433216, 0.12385513601746866]],
  [[-1.2305765883333211, -0.57022903529290581]],
  [[0.22717919504979503, -0.82063167970557871]]],
 [[[0.022799043136542397, 0.11406883791021294]],
  [[0.37216263779066844, -0.16945272070490716]],
  [[-0.10006347643470007, 0.059171129057440763]]]],
 [0.12356032293507928, 0.39947251420324081],
 [[[[-0.061098294746006844, -0.18662794232635463],
   [0.23737356351790589, 0.029576225337911509],
   [-0.026512356856014892, 0.098782679581618738],
   [0.13108984727276177, 0.082388912402616449]],
  [[0.15633577478249219, -0.063651633072354788],
   [-0.33488569902070592, -0.071896312148274924],
   [0.1850050699979213, -0.014106915885339242],
   [0.16384370135799806, -0.26097247708190474]],
  [[0.14711110389744406, -0.16252306395747376],
   [0.52074379658195846, -0.0084795111165281781],
   [-0.29180973621017048, -0.655058923381999],
   [0.18371344238948534, 0.0052634125716265277]]],
 [[[-0.01589127971202824, -0.0543346486377459],
   [0.17638449165323977, 0.049975901145386942],
   [-0.033835908536893625, 0.13726423948666774],
   [-0.13647761074371947, -0.24626297691099161]],
  [[0.16849975586476459, -0.040808579034144477],
   [0.024148759186605303, 0.27951031478355276],
   [-0.27978448000670431, -0.22656992568782683],
   [0.35884135537914807, 1.15703414476549]],
  [[0.022972155071407013, -0.10962753350904283],
   [0.097760622118457624, -0.29724348984463367],
   [0.28104296918546612, 0.87304525592259741],
   [0.51064757283960416, 0.69818869517390347]]],
 [[[0.23841641281055531, 0.17539286729465439],
   [-0.040851229441536949, 0.055242637541522317],
   [-0.0097354626753830154, -0.0534092871504539],
   [0.099836928388071719, 0.053992882049894532]],
  [[0.0927838965341867, 0.0778422343961737],
   [0.47795916800551852, 0.16909744728215545],
   [0.077257730928895221, -0.047607693040713939],
   [-0.038929769797627495, -0.10208236667106499]],
  [[0.05512110211869295, 0.11298963256786336],
   [-0.27672793286012004, -0.096963519056268613],
   [-0.13027592835294555, -0.17271401959604241],
   [-0.21265591417315863, -0.21307885180066422]]]],
 [0.19173076124624486, -0.0051927459197770682],
 [[[[0.051583695790095349, 0.03340402910561989],
   [-0.11290450962692043, -0.016936190066236485]],
  [[0.16139041555056863, 0.098054227538625652],
   [-0.014181936557149709, -0.03483420807831486]],
  [[0.16004992028813869, -0.0070773249502652617],
   [-0.0878823913334629, -0.0003224676408701947]]],
 [[[0.62225743967614311, 0.19419245946597194],
   [1.1291441545270173, 0.63184248260982978]],
  [[-0.054506174220297715, -0.15866443452345444],
   [0.21656617171900261, -0.0354119911680037]],
  [[0.10138653337477482, -0.0224383417290431],
   [-0.15123492671669736, 0.10346882856408834]]],
 [[[0.055342955260645588, -0.21231244429826834],
   [-0.3603274925140042, 0.23150098362547511]],
  [[0.37222141765059652, 0.19084663487752507],
   [-0.097128018860359988, -0.06002925099946671]],
  [[0.12494730914822412, 0.025833311184688439],
   [-0.0064403891177375744, -0.0323932723159207]]]],
 [0.28207604231354477, 0.24724383954065196],
 [[[[-0.16310978563226761, 0.3515894245323839]],
  [[-0.18213831070718775, 0.33592327978703468]],
  [[-0.034350534612957527, 0.29249257217931396]]],
 [[[0.33393313620479226, 0.45430271273069334]],
  [[0.042872303499352893, -0.092300843690924]],
  [[0.38803728775799917, 0.30656526896102793]]]],
 [0.26428609759678584, 0.10525048020337105],
 [[[[-0.34798934788012481, 0.5178827065257342]],
  [[0.15598641811278829, 0.23426032985423875]],
  [[0.062977641449002669, 0.04103744813552334]]],
 [[[-1.0469895949636765, 0.42123383205231835]],
  [[-0.026177272063757979, 0.62653892167379843]],
  [[-0.12662485330069259, -0.018329078207625134]]],
 [[[-1.1090108717011897, 0.17729674976722973]],
  [[-0.023336860217202608, -0.29512751357038275]],
  [[0.068780936656639341, -0.11476620685866647]]]],
 [0.33430159604928616, 0.37275381830469073],
 [[[[-0.2258111430190925, 0.14171727094076006],
   [-0.24534800639846255, 0.10804271665894781],
   [0.10536883441730385, 0.0031022465652591172],
   [0.041446749720974604, 0.040071562239791039]],
  [[-0.43197021040734818, -0.048259924540700494],
   [-0.28581383028716467, 0.047241056785628864],
   [-0.86214385295288232, -0.14576091059275167],
   [0.16555999933847931, 0.24301390710210871]],
  [[0.04188553564347515, 0.10187918395664783],
   [0.19396354310669717, 0.24982713940559131],
   [0.32825053111582009, 1.0337336706430857],
   [0.008237294568739173, 0.083049542723760653]]],
 [[[-0.028649100986752208, 0.25791685801643172],
   [-0.52283012256864181, 0.016246009652120127],
   [-0.0055599003122142341, 0.11605260792323764],
   [0.30276064316627466, 0.29244198487779804]],
  [[0.57250550878843487, 0.10755768703183846],
   [-0.12074892863186192, 0.038524341923648391],
   [-0.58537209361627207, 0.30710307866689623],
   [0.24812596116935179, -0.3170865235289555]],
  [[0.13149502772113986, 0.12459291644289353],
   [-0.19838570935536695, 0.15294262696753375],
   [-0.038682723280491965, 0.84194729960740422],
   [0.0054321287565664827, -0.14935921888140474]]],
 [[[-0.045584980352741583, 0.2229665376340034],
   [-0.077218114115186115, -0.14394805082624196],
   [0.12109673341200568, -0.068077389154001189],
   [0.044680605651711759, -0.14427524662836075]],
  [[0.19451945773641235, 0.30211316027157925],
   [0.13881372242046902, 0.14582022899421887],
   [0.028843449042777431, -0.054110795780586911],
   [0.18684887750647047, -0.21658230206261764]],
  [[0.13073204453550025, 0.397357179165236],
   [0.038869202229284146, 0.071991186379340183],
   [-0.13829824349169417, 0.17209088260423414],
   [0.032124978507057082, -0.29825059811473353]]]],
 [0.14353912550792863, 0.19743500573978265],
 [[[[-0.018379275793551985, -0.055663230707753905],
   [-0.024760573672070216, 0.026828446648922647]],
  [[-0.19287914250222959, -0.14191791662133535],
   [0.302311804331351, 0.097734701266669208]],
  [[-0.25977604140397792, -0.020445345610922473],
   [0.34499671050666142, -0.039356846757457771]]],
 [[[0.036210675296998167, 0.0071743179477991121],
   [0.34502282657733846, -0.12840292435290948]],
  [[0.013828633734164797, 0.1247192836653131],
   [1.3594450377898337, 0.6524863259070085]],
  [[-0.376927209652749, 0.54092411599856183],
   [0.1869677392222571, -0.21821128605347753]]],
 [[[-0.094550830147935014, -0.050135484971379561],
   [-0.076241029478840774, -0.033871617523655938]],
  [[0.20951924332491753, 0.11165085637556134],
   [0.15111279619274337, 0.12292454861198503]],
  [[-0.38129620584154766, 0.4191870724671205],
   [0.022645650844210233, 0.025505746406909568]]]],
 [0.22631204028703439, 0.11243873948752246]]
))
# Prepend the step size as we did not train it.
weights.insert(0, tf.constant(0.1, dtype=tf.float64))
# Also insert beta.
# infer is going to rewrite beta using mcmc's methods.
weights.insert(1, tf.constant(beta,dtype=tf.float64))

hmctrain.run(conf, mcmc, loss, opt, weights)
